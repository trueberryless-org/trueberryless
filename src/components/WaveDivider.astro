---
import { optimize } from "svgo";

interface Props {
  color: string;
  speed?: number; // Duration in seconds, default 60
  size?: number; // Circle size multiplier, default 1
  direction?: "left" | "right"; // Animation direction, default 'left'
}

const { color, speed = 60, size = 1, direction = "left" } = Astro.props;

const colorMap: any = {
  rosewater: "var(--ctp-rosewater)",
  flamingo: "var(--ctp-flamingo)",
  pink: "var(--ctp-pink)",
  mauve: "var(--ctp-mauve)",
  red: "var(--ctp-red)",
  maroon: "var(--ctp-maroon)",
  peach: "var(--ctp-peach)",
  yellow: "var(--ctp-yellow)",
  green: "var(--ctp-green)",
  teal: "var(--ctp-teal)",
  sky: "var(--ctp-sky)",
  sapphire: "var(--ctp-sapphire)",
  blue: "var(--ctp-blue)",
  lavender: "var(--ctp-lavender)",
};

const waveColor = colorMap[color];

// Generate smooth wave pattern - create exactly 3 repeating units for seamless loop
const generateWavePath = () => {
  let path = "M 0,20";
  const circleWidth = 10 * size;
  const amplitude = 12 * size;
  const circlesPerUnit = 40; // One complete wave unit
  const totalCircles = circlesPerUnit * 3; // 3 identical units for seamless animation

  for (let i = 0; i < totalCircles; i++) {
    const x = i * circleWidth;
    const direction = i % 2 === 0 ? -1 : 1;
    const y = 20 + amplitude * direction;
    path += ` Q ${x + circleWidth / 2},${y} ${x + circleWidth},20`;
  }
  return path;
};

const wavePath = generateWavePath();

// SVGO needs complete SVG string
const svgString = `<svg viewBox="0 0 1200 40" xmlns="http://www.w3.org/2000/svg">
  <path d="${wavePath}" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`;

const result = optimize(svgString);

// Extract the optimized path from the SVG
const pathMatch = result.data.match(/d="([^"]*)"/);
const optimizedWavePath = pathMatch ? pathMatch[1] : wavePath;

const animationClass =
  direction === "left" ? "wave-slide-left" : "wave-slide-right";
---

<div class="wave-container">
  <div class="wave-wrapper" style={`--wave-speed: ${speed}s`}>
    <svg
      class="wave"
      class:list={[animationClass]}
      viewBox="0 0 1200 40"
      preserveAspectRatio="none"
    >
      <path
        class="wave-path"
        d={optimizedWavePath}
        stroke={waveColor}
        stroke-width="3"
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"></path>
    </svg>
  </div>
</div>

<style>
  .wave-container {
    width: 100%;
    padding: 3rem 2rem;
    display: flex;
    justify-content: center;
  }

  .wave-wrapper {
    max-width: 600px;
    width: 100%;
    height: 40px;
    overflow: hidden;
    position: relative;
    mask-image: linear-gradient(
      to right,
      transparent 0%,
      black 8%,
      black 92%,
      transparent 100%
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent 0%,
      black 8%,
      black 92%,
      transparent 100%
    );
  }

  .wave {
    width: 300%;
    height: 100%;
    position: absolute;
  }

  .wave-path {
    vector-effect: non-scaling-stroke;
  }

  .wave-slide-left {
    left: -100%;
    animation: wave-slide-left var(--wave-speed) linear infinite;
  }

  .wave-slide-right {
    left: -66.67%;
    animation: wave-slide-right var(--wave-speed) linear infinite;
  }

  @keyframes wave-slide-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-33.33%);
    }
  }

  @keyframes wave-slide-right {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(33.33%);
    }
  }

  @media (max-width: 600px) {
    .wave-container {
      padding: 2rem 1rem;
    }
  }
</style>
